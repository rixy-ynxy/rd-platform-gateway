# =============================================================================
# Platform Gateway - Environment Variables Configuration
# =============================================================================
# このファイルを .env にコピーして、実際の値を設定してください
# 
# 開発環境: .dev.vars (Wrangler用)
# 本番環境: wrangler secret put コマンド使用
# =============================================================================

# -----------------------------------------------------------------------------
# アプリケーション設定
# -----------------------------------------------------------------------------
# 環境モード (development, production, demo)
ENVIRONMENT=development

# アプリケーションベースURL
APP_BASE_URL=http://localhost:3000
# 本番例: https://your-domain.pages.dev

# API ベースURL (通常はAPP_BASE_URL + /api)
API_BASE_URL=http://localhost:3000/api

# -----------------------------------------------------------------------------
# Keycloak OIDC認証設定
# -----------------------------------------------------------------------------
# KeycloakサーバーのベースURL (レルムURLではない)
KEYCLOAK_SERVER_URL=https://your-keycloak-server.com/realms/your-realm

# OIDCクライアント設定
KEYCLOAK_CLIENT_ID=platform-gateway-client
KEYCLOAK_CLIENT_SECRET=your-super-secret-client-secret

# Keycloakレルム名
KEYCLOAK_REALM=platform-gateway

# 認証リダイレクトURI
KEYCLOAK_REDIRECT_URI=http://localhost:3000/auth/callback
# 本番例: https://your-domain.pages.dev/auth/callback

# JWT署名検証用の公開鍵URL (自動設定される場合が多い)
KEYCLOAK_JWKS_URI=https://your-keycloak-server.com/realms/your-realm/protocol/openid-connect/certs

# -----------------------------------------------------------------------------
# Stripe決済設定
# -----------------------------------------------------------------------------
# Stripe秘密鍵 (sk_test_... または sk_live_...)
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key

# Stripe公開鍵 (pk_test_... または pk_live_...)
STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key

# Stripe Webhook署名用シークレット
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Stripe Connect設定
STRIPE_CONNECT_CLIENT_ID=ca_your_connect_client_id

# デフォルト通貨
STRIPE_DEFAULT_CURRENCY=USD

# -----------------------------------------------------------------------------
# データベース設定
# -----------------------------------------------------------------------------
# 【重要】Cloudflare D1は本番環境でのみ使用
# 開発・永続化にはSupabase PostgreSQLを推奨

# === Cloudflare D1 (本番用) ===
# D1データベースID (wrangler.jsonc で設定)
# CLOUDFLARE_D1_DATABASE_ID=your-d1-database-id

# === Supabase PostgreSQL (推奨) ===
# Supabase プロジェクトURL
SUPABASE_URL=https://your-project-ref.supabase.co

# Supabase匿名公開キー
SUPABASE_ANON_KEY=eyJ...your-anon-key

# Supabase サービスロールキー (サーバーサイド用)
SUPABASE_SERVICE_ROLE_KEY=eyJ...your-service-role-key

# PostgreSQL直接接続文字列 (必要に応じて)
DATABASE_URL=postgresql://postgres.your-ref:password@aws-0-ap-northeast-1.pooler.supabase.com:6543/postgres

# === 代替案: PlanetScale MySQL ===
# DATABASE_URL=mysql://username:password@aws.connect.psdb.cloud/database-name?sslaccept=strict

# === 代替案: Neon PostgreSQL ===
# DATABASE_URL=postgresql://username:password@ep-xxx.us-east-2.aws.neon.tech/database-name

# -----------------------------------------------------------------------------
# Cloudflare Workers設定
# -----------------------------------------------------------------------------
# Cloudflare Workers用の追加設定

# KVネームスペース (セッション管理用)
# CLOUDFLARE_KV_SESSIONS_ID=your-kv-namespace-id

# R2バケット (ファイルストレージ用)
# CLOUDFLARE_R2_BUCKET_NAME=your-r2-bucket-name

# Cloudflare API Token (デプロイ用)
CLOUDFLARE_API_TOKEN=your-cloudflare-api-token

# Cloudflare Zone ID (カスタムドメイン用)
# CLOUDFLARE_ZONE_ID=your-zone-id

# -----------------------------------------------------------------------------
# メール送信設定 (オプション)
# -----------------------------------------------------------------------------
# SendGrid APIキー
# SENDGRID_API_KEY=SG.your-sendgrid-api-key

# Resend APIキー
# RESEND_API_KEY=re_your-resend-api-key

# SMTP設定 (代替案)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-password

# -----------------------------------------------------------------------------
# セキュリティ設定
# -----------------------------------------------------------------------------
# JWT署名用の秘密鍵 (ランダムな64文字以上の文字列)
JWT_SECRET=your-super-long-random-jwt-secret-key-at-least-64-characters-long

# セッション暗号化キー
SESSION_SECRET=your-session-encryption-secret-key

# パスワードハッシュ用のソルト
BCRYPT_SALT_ROUNDS=12

# CORS許可オリジン (カンマ区切り)
CORS_ORIGINS=http://localhost:3000,https://your-domain.pages.dev

# -----------------------------------------------------------------------------
# ログ・監視設定
# -----------------------------------------------------------------------------
# ログレベル (debug, info, warn, error)
LOG_LEVEL=info

# Sentry DSN (エラー監視)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# データベース接続プール設定
DB_POOL_MIN=2
DB_POOL_MAX=10

# -----------------------------------------------------------------------------
# 開発環境専用設定
# -----------------------------------------------------------------------------
# デモモード有効化 (true/false)
DEMO_MODE=false

# 開発用のダミーデータ生成
SEED_DEMO_DATA=true

# Hot Reload有効化
DEV_HOT_RELOAD=true

# デバッグモード
DEBUG=true

# -----------------------------------------------------------------------------
# 本番環境専用設定
# -----------------------------------------------------------------------------
# Redis接続文字列 (キャッシュ用)
# REDIS_URL=redis://username:password@redis-host:6379

# CDN設定
# CDN_BASE_URL=https://cdn.your-domain.com

# 監査ログの保持期間 (日数)
AUDIT_LOG_RETENTION_DAYS=365

# レート制限設定
RATE_LIMIT_GENERAL=100  # 一般API (リクエスト/分)
RATE_LIMIT_AUTH=20      # 認証API (リクエスト/分)
RATE_LIMIT_PAYMENT=50   # 決済API (リクエスト/分)

# -----------------------------------------------------------------------------
# 設定ファイルの使い方
# -----------------------------------------------------------------------------
# 
# 1. 開発環境 (.dev.vars):
#    このファイルを .dev.vars にコピーして使用
#    Wranglerが自動的に読み込みます
# 
# 2. 本番環境 (Cloudflare Secrets):
#    wrangler secret put コマンドを使用
#    例: wrangler secret put STRIPE_SECRET_KEY --project-name platform-gateway
# 
# 3. 環境変数の優先度:
#    Cloudflare Secrets > .dev.vars > デフォルト値
# 
# 4. 機密情報の管理:
#    - .env, .dev.vars は .gitignore に含める
#    - 本番環境では必ずCloudflare Secretsを使用
#    - 開発チーム間での共有は安全な方法で行う
# 
# 5. 必須項目チェックリスト:
#    ✅ KEYCLOAK_SERVER_URL, KEYCLOAK_CLIENT_ID, KEYCLOAK_CLIENT_SECRET
#    ✅ STRIPE_SECRET_KEY, STRIPE_PUBLISHABLE_KEY
#    ✅ DATABASE_URL (Supabase/PlanetScale/Neon)
#    ✅ JWT_SECRET, SESSION_SECRET
#    ✅ APP_BASE_URL, API_BASE_URL
#
# =============================================================================